{% extends "base.html" %}
{% block content %}
<div class="container mt-5 w-50">
    <h2 class="text-center">Cargar nueva ruta</h2>

    <!-- Mensaje exitoso -->
    {% with messages = get_flashed_messages(with_categories=True) %}
      {% if messages %}
        <div class="alert alert-success" role="alert">
          {% for category, message in messages %}
            {{ message }}
          {% endfor %}
        </div>
      {% endif %}
    {% endwith %}

    <form method="POST" class="mt-4">
        <div class="form-group">
            <label for="agency_id">Agencia</label>
            <select class="form-control" id="agency_id" name="agency_id" required>
                {% for agency in agencies %}
                    <option value="{{ agency.agency_id }}">{{ agency.agency_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="route_short_name">Nombre corto</label>
            <input type="text" class="form-control" id="route_short_name" name="route_short_name" required>
        </div>
        <div class="form-group">
            <label for="route_long_name">Nombre largo</label>
            <input type="text" class="form-control" id="route_long_name" name="route_long_name" required>
        </div>
        <div class="form-group">
            <label for="route_type">Tipo de ruta (transporte)</label>
            <select class="form-control" id="route_type" name="route_type" required>
                <option value="3">Colectivo</option> <!-- 3: Bus -->
                <option value="0">Tranvía</option> <!-- 0: Tram -->
                <option value="1">Metro</option> <!-- 1: Subway -->
                <option value="2">Tren</option> <!-- 2: Rail -->
                <option value="4">Ferry</option> <!-- 4: Ferry -->
                <option value="5">Teleférico</option> <!-- 5: Cable Car -->
                <option value="6">Góndola</option> <!-- 6: Gondola -->
                <option value="7">Funicular</option> <!-- 7: Funicular -->
            </select>
        </div>
        <div class="form-group">
            <label for="route_color">Color (Opcional)</label>
            <input type="text" class="form-control" id="route_color" name="route_color" placeholder="#FF5733" maxlength="7">
            <small class="form-text text-muted">Usar formato hexadecimal (ej: #FF5733)</small>
        </div>
        <button type="submit" class="btn btn-primary">Cargar Ruta</button>
    </form>

    <!-- Routes Table -->
    <h3 class="mt-5">Rutas Registradas</h3>
    <table class="table table-striped mt-3">
        <thead>
            <tr>
                <th>ID</th>
                <th>Agencia</th>
                <th>Nombre Corto</th>
                <th>Nombre Largo</th>
                <th>Tipo</th>
                <th>Color</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for route in routes %}
                <tr>
                    <td>{{ route.route_id }}</td>
                    <td>{{ route.agency_id }}</td>
                    <td>{{ route.route_short_name }}</td>
                    <td>{{ route.route_long_name }}</td>
                    <td>{{ route.route_type }}</td>
                    <td>{{ route.route_color }}</td>
                    <td>
                        <form method="POST" action="{{ url_for('route.editar_route') }}">
                            <input type="hidden" name="route_id" value="{{ route.route_id }}">
                            <button type="submit" class="btn btn-warning btn-sm">Editar</button>
                        </form>
                        <form method="POST" action="{{ url_for('route.delete_route', route_id=route.route_id) }}" onsubmit="return confirm('¿Estás seguro de que deseas eliminar esta ruta?');">
                            <button type="submit" class="btn btn-danger btn-sm">Eliminar</button>
                        </form>
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}